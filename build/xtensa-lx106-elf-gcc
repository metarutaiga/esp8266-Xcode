#!/bin/bash

HAVE_AS=0
ARGS=""
while [[ $# > 0 ]] ; do
    case $1 in
        *.S)
        HAVE_AS=1;
        ARGS=$ARGS" "$1
        ;;
        -fstrict-volatile-bitfields*)
        ;;
        -g*)
        ;;
        -mlongcalls*)
        ;;
        -Wno-old-style-declaration*)
        ;;
        *)
        ARGS=$ARGS" "$1
        ;;
    esac
    shift
done

if [ $HAVE_AS = 0 ]; then
  ARGS=$ARGS" -target xtensa-lx106-elf -mcpu=esp8266 -fuse-ld=$BUILD_PATH/xtensa-lx106-elf-lld"
  ARGS=$ARGS" -Wno-sometimes-uninitialized"
  ARGS=$ARGS" -Wno-unused-command-line-argument" 
  ARGS=$ARGS" -Wno-parentheses-equality"
  ARGS=$ARGS" -Wno-tautological-pointer-compare"
  ARGS=$ARGS" -Wno-unknown-pragmas"
  ARGS=$ARGS" -Wno-uninitialized"
  ARGS=$ARGS" -Wno-array-parameter"
  ARGS=$ARGS" -Wno-format-security"

# echo clang $ARGS
  clang $ARGS
else
# echo xtensa-lx106-elf-gcc $ARGS
  $BUILD_PATH/xtensa-lx106-elf/bin/xtensa-lx106-elf-gcc $ARGS
fi