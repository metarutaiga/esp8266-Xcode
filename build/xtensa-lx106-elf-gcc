#!/bin/bash

ARGS=""
LONGCALLS=""
USE_GCC=0
while [[ $# > 0 ]] ; do
    case $1 in
        *.S)
        USE_GCC=1;
        ARGS=$ARGS" "$1
        ;;
        */bootloader/*)
        USE_GCC=1;
        ARGS=$ARGS" "$1
        ;;
        *esp_heap_caps.c)
        USE_GCC=1;
        ARGS=$ARGS" "$1
        ;;
        -fstrict-volatile-bitfields*)
        ;;
        -g*)
        ;;
        -mlongcalls*)
        LONGCALLS="-mlongcalls"
        ;;
        -Wno-old-style-declaration*)
        ;;
        *)
        ARGS=$ARGS" "$1
        ;;
    esac
    shift
done

if [ $USE_GCC -eq 1 ]; then
# echo xtensa-lx106-elf-gcc $ARGS
  $BUILD_PATH/xtensa-lx106-elf/bin/xtensa-lx106-elf-gcc $LONGCALLS $ARGS
else
  ARGS=$ARGS" -target xtensa-lx106-elf -mcpu=esp8266 -fuse-ld=$BUILD_PATH/xtensa-lx106-elf-lld"
  ARGS=$ARGS" -Wno-sometimes-uninitialized"
  ARGS=$ARGS" -Wno-unused-command-line-argument" 
  ARGS=$ARGS" -Wno-parentheses-equality"
  ARGS=$ARGS" -Wno-tautological-pointer-compare"
  ARGS=$ARGS" -Wno-unknown-pragmas"
  ARGS=$ARGS" -Wno-uninitialized"
  ARGS=$ARGS" -Wno-array-parameter"
  ARGS=$ARGS" -Wno-format-security"
  ARGS=$ARGS" -Oz"

# echo clang $ARGS
  clang $ARGS
fi