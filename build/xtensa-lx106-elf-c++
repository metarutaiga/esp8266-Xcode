#!/bin/bash

ARGS=""
ARGS_GCC=""
USE_GCC=1
while [[ $# > 0 ]] ; do
    case $1 in
        -fstrict-volatile-bitfields)
        ARGS_GCC=$ARGS_GCC" -fstrict-volatile-bitfields"
        ;;
        -g)
        ARGS_GCC=$ARGS_GCC" -g"
        ;;
        -mlongcalls)
        ARGS_GCC=$ARGS_GCC" -mlongcalls"
        ;;
        -Wno-old-style-declaration)
        ARGS_GCC=$ARGS_GCC" -Wno-old-style-declaration"
        ;;
        *.cc)
        ARGS=$ARGS" "$1
        ARGS_GCC=$ARGS_GCC" -D__FILE__=\""$(basename -- $1)"\" -Wno-builtin-macro-redefined"
        ;;
        *)
        ARGS=$ARGS" "$1
        ;;
    esac
    shift
done

if [ $USE_GCC -eq 1 ]; then
# echo xtensa-lx106-elf-c++ $ARGS_GCC $ARGS
  $BUILD_PATH/xtensa-lx106-elf/bin/xtensa-lx106-elf-c++ $ARGS_GCC $ARGS
else
  ARGS=$ARGS" -D__FILE__=__FILE_NAME__ -Wno-builtin-macro-redefined"
  ARGS=$ARGS" -target xtensa-lx106-elf -mcpu=esp8266 -fuse-ld=$BUILD_PATH/xtensa-lx106-elf-lld"
  ARGS=$ARGS" -Wno-sometimes-uninitialized"
  ARGS=$ARGS" -Wno-unused-command-line-argument" 
  ARGS=$ARGS" -Wno-parentheses-equality"
  ARGS=$ARGS" -Wno-tautological-pointer-compare"
  ARGS=$ARGS" -Wno-unknown-pragmas"
  ARGS=$ARGS" -Wno-uninitialized"
  ARGS=$ARGS" -Wno-array-parameter"
  ARGS=$ARGS" -Wno-format-security"
  ARGS=$ARGS" -I/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1"
  ARGS=$ARGS" -D_LIBCPP_DISABLE_EXTERN_TEMPLATE"
  ARGS=$ARGS" -D_LIBCPP_DISABLE_VISIBILITY_ANNOTATIONS"
  ARGS=$ARGS" -D_LIBCPP_HAS_NO_THREADS"
  ARGS=$ARGS" -Oz"

# echo clang++ $ARGS
  clang++ $ARGS
fi