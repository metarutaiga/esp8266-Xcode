#!/bin/bash

ARGS=""
LONGCALLS=""
USE_GCC=0
while [[ $# > 0 ]] ; do
    case $1 in
        -fstrict-volatile-bitfields*)
        ;;
        -g*)
        ;;
        -mlongcalls*)
        LONGCALLS="-mlongcalls"
        ;;
        -Wno-old-style-declaration*)
        ;;
        *)
        ARGS=$ARGS" "$1
        ;;
    esac
    shift
done

if [ $USE_GCC -eq 1 ]; then
# echo xtensa-lx106-elf-c++ $ARGS
  $BUILD_PATH/xtensa-lx106-elf/bin/xtensa-lx106-elf-c++ $LONGCALLS $ARGS
else
  ARGS=$ARGS" -target xtensa-lx106-elf -mcpu=esp8266 -fuse-ld=$BUILD_PATH/xtensa-lx106-elf-lld"
  ARGS=$ARGS" -Wno-sometimes-uninitialized"
  ARGS=$ARGS" -Wno-unused-command-line-argument" 
  ARGS=$ARGS" -Wno-parentheses-equality"
  ARGS=$ARGS" -Wno-tautological-pointer-compare"
  ARGS=$ARGS" -Wno-unknown-pragmas"
  ARGS=$ARGS" -Wno-uninitialized"
  ARGS=$ARGS" -Wno-array-parameter"
  ARGS=$ARGS" -Wno-format-security"
  ARGS=$ARGS" -I/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/include/c++/v1"
  ARGS=$ARGS" -D_LIBCPP_DISABLE_EXTERN_TEMPLATE"
  ARGS=$ARGS" -D_LIBCPP_DISABLE_VISIBILITY_ANNOTATIONS"
  ARGS=$ARGS" -D_LIBCPP_HAS_NO_THREADS"
  ARGS=$ARGS" -Oz"

# echo clang++ $ARGS
  clang++ $ARGS
fi